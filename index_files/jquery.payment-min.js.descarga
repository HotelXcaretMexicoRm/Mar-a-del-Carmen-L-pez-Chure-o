(function () { var t, e, n, r, a, o, i, u, l, s, c, h, p, f, g, d, v, m, y, C, T, w, k = [].slice, D = [].indexOf || function (t) { for (var e = 0, n = this.length; e < n; e++)if (e in this && this[e] === t) return e; return -1 }; (t = this.jQuery).payment = {}, t.payment.fn = {}, t.fn.payment = function () { var e, n; return n = arguments[0], e = 2 <= arguments.length ? k.call(arguments, 1) : [], t.payment.fn[n].apply(this, e) }, a = /(\d{1,4})/g, t.payment.cards = r = [{ type: "visaelectron", customCode: "VISA", class: "visa", pattern: /^4(026|17500|405|508|844|91[37])/, format: a, length: [16], cvcLength: [3], luhn: !0 }, { type: "maestro", customCode: "-1", class: "unknown", pattern: /^(5(018|0[23]|[68])|6(39|7))/, format: a, length: [12, 13, 14, 15, 16, 17, 18, 19], cvcLength: [3], luhn: !0 }, { type: "forbrugsforeningen", customCode: "-1", class: "unknown", pattern: /^600/, format: a, length: [16], cvcLength: [3], luhn: !0 }, { type: "dankort", customCode: "-1", class: "unknown", pattern: /^5019/, format: a, length: [16], cvcLength: [3], luhn: !0 }, { type: "visa", customCode: "VISA", class: "visa", pattern: /^4/, format: a, length: [13, 16], cvcLength: [3], luhn: !0 }, { type: "mastercard", customCode: "MC", class: "mastercard", pattern: /^5[0-5]/, format: a, length: [16], cvcLength: [3], luhn: !0 }, { type: "amex", customCode: "AMEX", class: "amex", pattern: /^3[47]/, format: /(\d{1,4})(\d{1,6})?(\d{1,5})?/, length: [15], cvcLength: [3, 4], luhn: !0 }, { type: "dinersclub", customCode: "DINERS", class: "DINERS", pattern: /^3[0689]/, format: a, length: [14, 16, 17, 18, 19], cvcLength: [3], luhn: !0 }, { type: "discover", customCode: "DINERS", class: "DINERS", pattern: /^6([045])/, format: a, length: [14, 16, 17, 18, 19], cvcLength: [3], luhn: !0 }, { type: "unionpay", customCode: "-1", class: "unknown", pattern: /^(62|88)/, format: a, length: [16, 17, 18, 19], cvcLength: [3], luhn: !1 }, { type: "jcb", customCode: "-1", class: "unknown", pattern: /^35/, format: a, length: [16], cvcLength: [3], luhn: !0 }], e = function (t) { var e, n, a; for (t = (t + "").replace(/\D/g, ""), n = 0, a = r.length; n < a; n++)if ((e = r[n]).pattern.test(t)) return e }, n = function (t) { var e, n, a; for (n = 0, a = r.length; n < a; n++)if ((e = r[n]).type === t) return e }, p = function (t) { var e, n, r, a, o, i; for (r = !0, a = 0, o = 0, i = (n = (t + "").split("").reverse()).length; o < i; o++)e = n[o], e = parseInt(e, 10), (r = !r) && (e *= 2), e > 9 && (e -= 9), a += e; return a % 10 == 0 }, h = function (t) { var e; return null != t.prop("selectionStart") && t.prop("selectionStart") !== t.prop("selectionEnd") || !(null == ("undefined" != typeof document && null !== document && null != (e = document.selection) ? e.createRange : void 0) || !document.selection.createRange().text) }, v = function (e) { return setTimeout(function () { var n, r; return r = (r = (n = t(e.currentTarget)).val()).replace(/\D/g, ""), n.val(r) }) }, g = function (e) { return setTimeout(function () { var n, r; if (!0 !== (n = t(e.currentTarget)).hasClass("ap_prevent")) return r = n.val(), r = t.payment.formatCardNumber(r), n.val(r) }) }, u = function (n) { var r, a, o, i, u, l, s; if (o = String.fromCharCode(n.which), /^\d+$/.test(o) && (r = t(n.currentTarget), s = r.val(), a = e(s + o), i = (s.replace(/\D/g, "") + o).length, r.removeClass("ap_prevent"), l = 16, a && (l = a.length[a.length.length - 1]), !(i >= l || null != r.prop("selectionStart") && r.prop("selectionStart") !== s.length))) return (u = a && "amex" === a.type ? /^(\d{4}|\d{4}\s\d{6})$/ : /(?:^|\s)(\d{4})$/).test(s) ? (n.preventDefault(), setTimeout(function () { return r.val(s + " " + o) })) : u.test(s + o) ? (n.preventDefault(), setTimeout(function () { return r.val(s + o + " ") })) : void 0 }, o = function (e) { var n, r; if (n = t(e.currentTarget), r = n.val(), 8 === e.which && (n.addClass("ap_prevent"), null == n.prop("selectionStart") || n.prop("selectionStart") === r.length)) return /\d\s$/.test(r) ? (e.preventDefault(), setTimeout(function () { return n.val(r.replace(/\d\s$/, "")) })) : /\s\d?$/.test(r) ? (e.preventDefault(), setTimeout(function () { return n.val(r.replace(/\d$/, "")) })) : void 0 }, d = function (e) { return setTimeout(function () { var n, r; return r = (n = t(e.currentTarget)).val(), r = t.payment.formatExpiry(r), n.val(r) }) }, l = function (e) { var n, r, a; if (r = String.fromCharCode(e.which), /^\d+$/.test(r)) return n = t(e.currentTarget), a = n.val() + r, /^\d$/.test(a) && "0" !== a && "1" !== a ? (e.preventDefault(), setTimeout(function () { return n.val("0" + a + " / ") })) : /^\d\d$/.test(a) ? (e.preventDefault(), setTimeout(function () { return n.val(a + " / ") })) : void 0 }, s = function (e) { var n, r, a; if (r = String.fromCharCode(e.which), /^\d+$/.test(r)) return a = (n = t(e.currentTarget)).val(), /^\d\d$/.test(a) ? n.val(a + " / ") : void 0 }, c = function (e) { var n, r, a; if ("/" === (a = String.fromCharCode(e.which)) || " " === a) return r = (n = t(e.currentTarget)).val(), /^\d$/.test(r) && "0" !== r ? n.val("0" + r + " / ") : void 0 }, i = function (e) { var n, r; if (n = t(e.currentTarget), r = n.val(), 8 === e.which && (null == n.prop("selectionStart") || n.prop("selectionStart") === r.length)) return /\d\s\/\s$/.test(r) ? (e.preventDefault(), setTimeout(function () { return n.val(r.replace(/\d\s\/\s$/, "")) })) : void 0 }, f = function (e) { return setTimeout(function () { var n, r; return r = (r = (n = t(e.currentTarget)).val()).replace(/\D/g, "").slice(0, 4), n.val(r) }) }, T = function (t) { var e; return !(!t.metaKey && !t.ctrlKey) || 32 !== t.which && (0 === t.which || t.which < 33 || (e = String.fromCharCode(t.which), !!/[\d\s]/.test(e))) }, y = function (n) { var r, a, o, i; if (r = t(n.currentTarget), o = String.fromCharCode(n.which), /^\d+$/.test(o) && !h(r)) return i = (r.val() + o).replace(/\D/g, ""), (a = e(i)) ? i.length <= a.length[a.length.length - 1] : i.length <= 16 }, C = function (e) { var n, r; if (n = t(e.currentTarget), r = String.fromCharCode(e.which), /^\d+$/.test(r) && !h(n)) return !((n.val() + r).replace(/\D/g, "").length > 6) && void 0 }, m = function (e) { var n, r; if (n = t(e.currentTarget), r = String.fromCharCode(e.which), /^\d+$/.test(r) && !h(n)) return (n.val() + r).length <= 4 }, w = function (e, n) { var a, o, i, u, l, s; if (s = (a = t(e.currentTarget)).val(), l = (null != (u = t.payment.cardTypeObject(s) || null) ? u.type : void 0) || "unknown", !a.hasClass(l) && (o = function () { var t, e, n; for (n = [], t = 0, e = r.length; t < e; t++)i = r[t], n.push(i.type); return n }(), n && !0 === n.addClass && (a.removeClass("unknown"), a.removeClass(o.join(" ")), a.addClass(l), a.toggleClass("identified", "unknown" !== l), a.trigger("payment.cardType", l)), n && "function" == typeof n.callback)) return n.callback(u) }, t.payment.fn.formatCardCVC = function () { return this.on("keypress", T), this.on("keypress", m), this.on("paste", f), this.on("change", f), this.on("input", f), this }, t.payment.fn.formatCardExpiry = function () { return this.on("keypress", T), this.on("keypress", C), this.on("keypress", l), this.on("keypress", c), this.on("keypress", s), this.on("keydown", i), this.on("change", d), this.on("input", d), this }, t.payment.fn.formatCardNumber = function (t) { var e, n; return this.on("keypress", T), this.on("keypress", y), this.on("keypress", u), this.on("keydown", o), e = t, this.on("keyup", function (t) { return w(t, e) }), this.on("paste", g), this.on("change", g), this.on("input", g), n = t, this.on("input", function (t) { return w(t, n) }), this }, t.payment.fn.restrictNumeric = function () { return this.on("keypress", T), this.on("paste", v), this.on("change", v), this.on("input", v), this }, t.payment.fn.cardExpiryVal = function () { return t.payment.cardExpiryVal(t(this).val()) }, t.payment.cardExpiryVal = function (t) { var e, n, r; return e = (r = (t = t.replace(/\s/g, "")).split("/", 2))[0], 2 === (null != (n = r[1]) ? n.length : void 0) && /^\d+$/.test(n) && (n = (new Date).getFullYear().toString().slice(0, 2) + n), { month: e = parseInt(e, 10), year: n = parseInt(n, 10) } }, t.payment.validateCardNumber = function (t) { var n, r; return t = (t + "").replace(/\s+|-/g, ""), !!/^\d+$/.test(t) && !!(n = e(t)) && (r = t.length, D.call(n.length, r) >= 0 && (!1 === n.luhn || p(t))) }, t.payment.validateCardExpiry = function (e, n) { var r, a, o; return "object" == typeof e && "month" in e && (e = (o = e).month, n = o.year), !(!e || !n) && (e = t.trim(e), n = t.trim(n), !!/^\d+$/.test(e) && !!/^\d+$/.test(n) && 1 <= e && e <= 12 && (2 === n.length && (n = n < 70 ? "20" + n : "19" + n), 4 === n.length && (a = new Date(n, e), r = new Date, a.setMonth(a.getMonth() - 1), a.setMonth(a.getMonth() + 1, 1), a > r))) }, t.payment.validateCardCVC = function (e, r) { var a, o; return e = t.trim(e), !!/^\d+$/.test(e) && (null != (a = n(r)) ? (o = e.length, D.call(a.cvcLength, o) >= 0) : e.length >= 3 && e.length <= 4) }, t.payment.cardType = function (t) { var n; return t && (null != (n = e(t)) ? n.type : void 0) || null }, t.payment.cardTypeObject = function (t) { return t && e(t) || null }, t.payment.formatCardNumber = function (n) { var r, a, o, i; return n = n.replace(/\D/g, ""), (r = e(n)) ? (o = r.length[r.length.length - 1], n = n.slice(0, o), r.format.global ? null != (i = n.match(r.format)) ? i.join(" ") : void 0 : null != (a = r.format.exec(n)) ? (a.shift(), (a = t.grep(a, function (t) { return t })).join(" ")) : void 0) : n }, t.payment.formatExpiry = function (t) { var e, n, r, a; return (n = t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/)) ? (e = n[1] || "", r = n[2] || "", (a = n[3] || "").length > 0 ? r = " / " : " /" === r ? (e = e.substring(0, 1), r = "") : 2 === e.length || r.length > 0 ? r = " / " : 1 === e.length && "0" !== e && "1" !== e && (e = "0" + e, r = " / "), e + r + a) : "" } }).call(this);